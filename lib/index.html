<html>
<head>
  <title>Time-Approver</title>
  <link rel="stylesheet" href="./css/smalltalk.css">
  <link rel="stylesheet" href="./css/foundation.custom.css">
  <link rel="stylesheet" href="./css/approver.css">
<body>
  <script>
    window.$ = window.jQuery = require("jquery");
  </script>
  <script>

    var disapprove = function(id, originalReason){
      var smalltalk = require("smalltalk");
      var ipc = require('ipc');
      var value = $("input"+id).val();
      $('#div_' + element_id)[0].scrollIntoView( true );
      var disapproved = ipc.sendSync('disapprove', id, originalReason+": "+value);
      if(disapproved){
        $(".message"+id).addClass("error")
      }else{
        smalltalk.alert('Error', 'There was an error!')
      }
    }

    var toggle = function(id){
      $('#row' + id).toggle();
      $('#row' + id)[0].scrollIntoView( true );
    }

    require('ipc').on('about', function() {
      require("smalltalk").alert('About', 'This application allows you to review and approve time.')
    });

    require('ipc').on('insertRow', function(message, level, type) {
      var div = "<div class='row "
      if(level=="success" || level=="warning" || level=="error"){
        div += level
      }
      div += "'>"
      if(type=="heading"){
        div += "<div class='columns small-12'><h3>"+message+"</h3></div>"
      }else if(type=="time"){
        var m = message.description.split("'").join("\\'")
        div += "<div class='columns large-4 message"+message.id+"'>"
          div += "<div class='row'>"
            div += "<div class='columns small-3'><a href='#' onClick='toggle(\""+message.id+"\")'>"+"X</a>"
              div += '<div id="row'+message.id+'" class="row collapse postfix-round" style="display:none;"><div class="small-9 columns"><input type="text" id="input'+message.id+'" placeholder="Reason"></div>'
                div += "<div class='small-3 columns'><a href='#' class='button postfix' onClick=\"disapprove('"+message.id+"', '"+m+"')\">Go</a></div>"
              div += "</div>"
            div += "</div>"
            div += "<div class='columns small-4'>"+message.date+"</div>"
            div += "<div class='columns small-2'>"+message.time+"</div>"
            div += "<div class='columns small-3'>"+message.billing+"</div>"
          div += "</div>"
        div += "</div>"
        div += "<div class='columns large-8 message"+message.id+"'>"
          div += "<div class='row'>"
            div += "<div class='columns small-2'>"+message.task+"</div>"
            div += "<div class='columns small-3'>"+message.proposal+"</div>"
            div += "<div class='columns small-7'>"+message.description+"</div>"
          div += "</div>"
        div += "</div>"
      }else{
        div += "<div class='columns small-12'>"+message+"</div>"
      }
      div += "</div>"
      $("#console").append(div)
    });
  </script>
  <div id="console"></div>
</body>
</html>
